<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>AutoEscuela App</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
    <script type="importmap">
    {
      "imports": {
        "./alumnosModule.js": "./alumnosModule.js",
        "./alumnosControlador.js": "./alumnosControlador.js", 
        "./alumnosLista.js": "./alumnosLista.js",
        "./alumnosVista.js": "./alumnosVista.js",
        "./candidatosModule.js": "./candidatosModule.js",
        "./faltasModule.js": "./faltasModule.js",
        "./catalogoFaltas.js": "./catalogoFaltas.js",
        "./simulacroModule.js": "./simulacroModule.js",
        "./db.js": "./db.js",
        "./navigation.js": "./navigation.js",
        "./ui.js": "./ui.js",
        "./pdfModule.js": "./pdfModule.js"
      }
    }
    </script>
</head>
<body>
    <!-- PANTALLA DE BIENVENIDA -->
    <div id="pantalla-bienvenida" class="pantalla">
        <div class="contenedor-centrado">
            <h1>SimulApp</h1>
            <img src="Picsart_25-05-15_15-31-16-144.png" alt="Logo AutoEscuela" class="logo">
            <p style="text-align: center;">Simulacros de Pruebas de Circulación</p>
            <button id="btn-entrar" class="btn-principal">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"></path><path d="m12 5 7 7-7 7"></path></svg>
                ENTRAR
            </button>
        </div>
    </div>

    <!-- PANTALLA DE MENÚ PRINCIPAL -->
    <div id="pantalla-menu" class="pantalla oculto">
        <div class="header">
            <h2>Menú Principal</h2>
        </div>
        <div class="contenedor-opciones">
            <button id="btn-anadir-alumno" class="btn-opcion">
                <span class="icono">
                    <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M12 8v8"></path><path d="M8 12h8"></path></svg>
                </span>
                <span>Añadir Alumno</span>
            </button>
            <button id="btn-buscar-alumno" class="btn-opcion">
                <span class="icono">
                    <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.3-4.3"></path></svg>
                </span>
                <span>Buscar Alumno</span>
            </button>
            <button id="btn-candidatos" class="btn-opcion">
                <span class="icono">
                    <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8.21 13.89 7 23l5-3 5 3-1.21-9.12"></path><circle cx="12" cy="8" r="7"></circle></svg>
                </span>
                <span>Candidatos a Examen</span>
            </button>
            <button id="btn-configurar-faltas" class="btn-opcion">
                <span class="icono">
                    <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>
                </span>
                <span>Configurar Faltas</span>
            </button>
        </div>
        <div class="footer-menu">
            <button id="btn-info" class="btn-info">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>
                Info App
            </button>
        </div>
    </div>

    <!-- PANTALLA AÑADIR ALUMNO -->
    <div id="pantalla-anadir-alumno" class="pantalla oculto">
        <div class="header">
            <button class="btn-menu">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
            </button>
            <h2>Añadir Alumno</h2>
        </div>
        <div class="formulario">
            <div class="campo">
                <input type="number" 
                       id="numero-alumno" 
                       placeholder="Número (Ej: 12345)" 
                       min="0"
                       max="99999"
                       inputmode="numeric"
                       pattern="\d{1,5}"
                       oninput="if(this.value.length > 5) this.value = this.value.slice(0,5)">
            </div>
            <div class="campo">
                <input type="text" 
                       id="nombre-alumno" 
                       placeholder="Nombre"
                       maxlength="24"
                       pattern="[A-Za-zÁáÉéÍíÓóÚúÑñ\s]+"
                       oninput="this.value = this.value.replace(/[^A-Za-zÁáÉéÍíÓóÚúÑñ\s]/g, '')">
            </div>
            <div class="campo">
                <input type="text" 
                       id="apellido-alumno" 
                       placeholder="Apellido"
                       maxlength="24"
                       pattern="[A-Za-zÁáÉéÍíÓóÚúÑñ\s]+"
                       oninput="this.value = this.value.replace(/[^A-Za-zÁáÉéÍíÓóÚúÑñ\s]/g, '')">
            </div>
            <button id="btn-guardar-alumno" class="btn-principal">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></svg>
                Guardar Alumno
            </button>
        </div>
    </div>

    <!-- PANTALLA BUSCAR ALUMNO -->
    <div id="pantalla-buscar-alumno" class="pantalla oculto">
        <div class="header">
            <button class="btn-menu">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
            </button>
            <h2>Buscar Alumno</h2>
        </div>
        <div class="buscador">
            <input type="text" id="input-buscar" placeholder="Buscar por apellido...">
        </div>
        <div id="lista-alumnos" class="lista-resultados">
            <!-- Los alumnos se cargarán dinámicamente aquí -->
        </div>
    </div>

    <!-- PANTALLA FICHA ALUMNO -->
    <div id="pantalla-ficha-alumno" class="pantalla oculto">
        <div class="header">
            <button class="btn-menu">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
            </button>
            <h2>Ficha del Alumno</h2>
        </div>
        <div id="datos-alumno" class="datos-ficha">
            <!-- Los datos del alumno se cargarán dinámicamente aquí -->
        </div>
        <div class="acciones-ficha">
            <button id="btn-nuevo-simulacro" class="btn-principal">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>
                Nuevo Simulacro
            </button>
            <button id="btn-exportar-ficha" class="btn-secundario">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
                Exportar Ficha PDF
            </button>
        </div>

<h3 style="text-align: center; margin: 24px 0;">Simulacros Realizados</h3>
        <div id="lista-simulacros" class="lista-resultados">
            <!-- Los simulacros se cargarán dinámicamente aquí -->
        </div>
    </div>

    <!-- PANTALLA SIMULACRO -->
    <div id="pantalla-simulacro" class="pantalla oculto">
        <div class="header">
            <button id="btn-volver-simulacro" class="btn-menu">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 18l-6-6 6-6"></path></svg>
            </button>
            <h2>Simulacro en Curso</h2>
        </div>
        <div class="info-simulacro">
            <div id="datos-simulacro-alumno"></div>
            <div id="cronometro">00:00:00</div>
        </div>
        <div class="selector-faltas">
            <div class="tabs">
                <button class="tab-btn activo" data-tipo="leve">Leves</button>
                <button class="tab-btn" data-tipo="deficiente">Deficientes</button>
                <button class="tab-btn" data-tipo="eliminatoria">Eliminatorias</button>
            </div>
            <div class="contenido-tabs">
                <div id="lista-faltas" class="lista-faltas">
                    <!-- Las faltas se cargarán dinámicamente aquí -->
                </div>
            </div>
        </div>
        <div class="resumen-faltas">
            <div class="contador-faltas">
                <span class="tipo-leve">Leves: <span id="contador-leves">0</span></span>
                <span class="tipo-deficiente">Deficientes: <span id="contador-deficientes">0</span></span>
                <span class="tipo-eliminatoria">Eliminatorias: <span id="contador-eliminatorias">0</span></span>
            </div>
        </div>
        <div class="acciones-simulacro">
            <button id="btn-iniciar-prueba" class="btn-principal">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>
                INICIAR PRUEBA
            </button>
            <button id="btn-finalizar-simulacro" class="btn-principal">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"></path><path d="m6 6 12 12"></path></svg>
                FINALIZAR PRUEBA
            </button>
        </div>
    </div>

    <!-- PANTALLA INFORME SIMULACRO -->
    <div id="pantalla-informe" class="pantalla oculto">
        <div class="header">
            <button class="btn-menu">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
            </button>
            <h2>Informe de Simulacro</h2>
        </div>
        <div id="contenido-informe" class="informe">
            <!-- El informe se generará dinámicamente aquí -->
        </div>
        <div class="seccion-observaciones">
            <h3>Observaciones</h3>
            <textarea id="texto-observaciones" placeholder="Introduce aquí tus observaciones sobre el simulacro..."></textarea>
            <button id="btn-guardar-observaciones" class="btn-secundario">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></svg>
                Guardar Observaciones
            </button>
        </div>
        <div class="acciones-informe">
            <button id="btn-exportar-informe" class="btn-principal">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
                Exportar Informe PDF
            </button>
            <button id="btn-volver-ficha" class="btn-secundario">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 18l-6-6 6-6"></path></svg>
                Volver a Ficha
            </button>
            <button id="btn-ver-resultado" class="btn-principal">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"></path><circle cx="12" cy="12" r="3"></circle></svg>
                VER RESULTADO FINAL
            </button>
        </div>
    </div>

    <!-- PANTALLA RESULTADO FINAL -->
    <div id="pantalla-resultado" class="pantalla oculto">
        <div id="contenido-resultado" class="resultado-final">
            <!-- El resultado se generará dinámicamente aquí -->
        </div>
        <div class="acciones-resultado">
            <button id="btn-volver-menu" class="btn-principal">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
                Volver al Menú
            </button>
        </div>
    </div>
    
    <!-- PANTALLA CANDIDATOS EXAMEN -->
    <div id="pantalla-candidatos" class="pantalla oculto">
        <div class="header">
            <button class="btn-menu">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
            </button>
            <h2>Candidatos</h2>
        </div>
        <div class="cabecera-candidatos">
            <div class="buscador">
                <input type="text" id="input-buscar-candidato" placeholder="Buscar candidato por apellido...">
            </div>
            <p class="titulo-candidatos">Alumnos con 3 o más simulacros APTOS</p>  
        </div>
        <div id="lista-candidatos" class="lista-candidatos">
            <!-- Los candidatos se cargarán dinámicamente aquí -->
        </div>
        <div class="acciones-candidatos">
            <button id="btn-exportar-candidatos" class="btn-principal">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
                Exportar Lista PDF
            </button>
        </div>
    </div>

    <!-- PANTALLA CONFIGURACIÓN DE FALTAS -->
    <div id="pantalla-config-faltas" class="pantalla oculto">
        <div class="header">
            <button class="btn-menu">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
            </button>
            <h2>Configuración</h2>
        </div>
        
        <div class="formulario formulario-faltas">
            <div class="form-header">
                
                <h3 style="text-align: center;">Añadir Faltas</h3>
            </div>
            <div class="campo">
                <label for="codigo-falta">Código:</label>
                <input type="text" id="codigo-falta" placeholder="Ej: 4.3" maxlength="5">
            </div>
            <div class="campo">
                <label for="descripcion-falta">Descripción:</label>
                <input type="text" id="descripcion-falta" placeholder="Descripción de la falta">
            </div>
            <div class="campo">
                <label for="tipo-falta">Tipo de Falta:</label>
                <select id="tipo-falta">
                    <option value="leve">Leve</option>
                    <option value="deficiente">Deficiente</option>
                    <option value="eliminatoria">Eliminatoria</option>
                </select>
            </div>
            <div class="botones-form">
                <button id="btn-agregar-falta" class="btn-principal">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M12 8v8"></path><path d="M8 12h8"></path></svg>
                    Agregar Falta
                </button>
                <button id="btn-cancelar-edicion" class="btn-secundario" style="display: none;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="m15 9-6 6"></path><path d="m9 9 6 6"></path></svg>
                    Cancelar
                </button>
            </div>
        </div>
        
        <div class="seleccionar-todas">
            <input type="checkbox" id="seleccionar-todas-faltas">
            <label for="seleccionar-todas-faltas">Mostrar todas en simulacros</label>
        </div>
        
        <div id="lista-config-faltas" class="lista-resultados">
            <!-- Las faltas se cargarán dinámicamente aquí -->
        </div>
    </div>

    <!-- PANTALLA DE CRÉDITOS/INFO -->
    <div id="pantalla-creditos" class="pantalla oculto">
        <div class="header">
            <button class="btn-menu">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
            </button>
            <h2>Información</h2>
        </div>
        <div class="contenedor-creditos">
            <div><br>
                <h3 style="text-align: justify; margin: 24px 0;">Esta aplicación ha sido creada por Roberto Blanco Díaz. Queda prohibida su distribución, uso o manipulación sin el previo consentimiento del autor. Para más información pueden enviar un email a:</h3>
                <h3><a href="/cdn-cgi/l/email-protection#741d171b1a4540444d341319151d185a171b19"><span class="__cf_email__" data-cfemail="a3c0c6cc8dd0caced6cfc2d3d3e3c4cec2cacf8dc0ccce">[email&#160;protected]</span></a></h3>
            </div>
        </div>
    </div>

    <!-- PANTALLA BIBLIOTECA DE PDFS - ELIMINADA -->

    <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script src="catalogoFaltas.js" type="module"></script>
    <script src="faltasModule.js" type="module"></script>
    <script src="navigation.js" type="module"></script>
    <script src="db.js" type="module"></script>
    <script src="ui.js" type="module"></script>
    <script src="alumnosModule.js" type="module"></script>
    <script src="simulacroModule.js" type="module"></script>
    <script src="pdfModule.js" type="module"></script>
    <script src="app.js" type="module"></script>
</body>
</html>